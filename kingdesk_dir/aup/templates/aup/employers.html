{% extends 'aup/layout.html' %}
{% load static %}

{% block title %}KING Desk - Сотрудники{% endblock %}
{% block content %}
    <div class="content text-center">
        <div class="happy_new_year PC" style="margin-top: 5%;">
            <script src="//megatimer.ru/get/568dfb71e1a87a8c62652aaa419287d1.js"></script>
        </div>
        <h1 class="title">Сотрудники</h1>
        <div class="container employers_list">
            <p class="text employers group">Директор</p>
            {% for i in employers %}
            {% if i.post_id.post_code == 'a-03' and i.division_id == user.division_id %}
            <a class="container employers" href="{% url 'aup_employer_info' i.id%}">
                {% if i.photo %}
                <img src="{{i.photo.url}}" class="employers">
                {% else %}
                {% if i.gender_id.gender_name == 'Мужской' %}
                <img src="{% static 'hbr/img/user.png' %}" class="employers">
                {% else %}
                <img src="{% static 'hbr/img/user (1).png' %}" class="employers">
                {% endif %}
                {% endif %}
                <p class="text employers">{{i.surname}} {{i.name}} 
                    {% if i.lastname != '-'%}
                    {{i.lastname}}
                    {% endif %}
                </p>
            </a>
            {% endif %}
            {% endfor %}
            <p class="text employers group">Заместитель директора</p>
            {% for i in employers %}
            {% if i.post_id.post_code == 'a-02' and i.division_id == user.division_id %}
            <a class="container employers" href="{% url 'aup_employer_info' i.id%}">
                {% if i.photo %}
                <img src="{{i.photo.url}}" class="employers">
                {% else %}
                {% if i.gender_id.id == 1 %}
                <img src="{% static 'hbr/img/user.png' %}" class="employers">
                {% else %}
                <img src="{% static 'hbr/img/user (1).png' %}" class="employers">
                {% endif %}
                {% endif %}
                <p class="text employers">{{i.surname}} {{i.name}} 
                    {% if i.lastname != '-'%}
                    {{i.lastname}}
                    {% endif %}
                </p>
            </a>
            {% endif %}
            {% endfor %}
            <p class="text employers group">Менеджеры</p>
            {% for i in employers %}
            {% if i.post_id.post_code == 'a-01' and i.division_id == user.division_id %}
            <a class="container employers" href="{% url 'aup_employer_info' i.id%}">
                {% if i.photo %}
                <img src="{{i.photo.url}}" class="employers">
                {% else %}
                {% if i.gender_id.id == 1 %}
                <img src="{% static 'hbr/img/user.png' %}" class="employers">
                {% else %}
                <img src="{% static 'hbr/img/user (1).png' %}" class="employers">
                {% endif %}
                {% endif %}
                <p class="text employers">{{i.surname}} {{i.name}} 
                    {% if i.lastname != '-'%}
                    {{i.lastname}}
                    {% endif %}
                </p>
            </a>
            {% endif %}
            {% endfor %}
            <p class="text employers group">Тренеры</p>
            {% for i in employers %}
            {% if i.post_id.post_code == 'h-05' and i.division_id == user.division_id %}
            <a class="container employers" href="{% url 'aup_employer_info' i.id%}">
                {% if i.photo %}
                <img src="{{i.photo.url}}" class="employers">
                {% else %}
                {% if i.gender_id.id == 1 %}
                <img src="{% static 'hbr/img/user.png' %}" class="employers">
                {% else %}
                <img src="{% static 'hbr/img/user (1).png' %}" class="employers">
                {% endif %}
                {% endif %}
                <p class="text employers">{{i.surname}} {{i.name}} 
                    {% if i.lastname != '-'%}
                    {{i.lastname}}
                    {% endif %}
                    
                </p>
            </a>
            {% endif %}
            {% endfor %}
            <p class="text employers group">Остальные сотрудники</p>
            {% for i in employers %}
            {% if i.post_id.post_code in hbr_employers and i.post_id.post_code != 'h-05' and i.division_id == user.division_id %}
            <a href="{% url 'aup_employer_info' i.id%}" class="container employers">
                {% if i.photo %}
                <img src="{{i.photo.url}}" class="employers">
                {% else %}
                {% if i.gender_id.id == 1 %}
                <img src="{% static 'hbr/img/user.png' %}" class="employers">
                {% else %}
                <img src="{% static 'hbr/img/user (1).png' %}" class="employers">
                {% endif %}
                {% endif %}
                <p class="text employers">{{i.surname}} {{i.name}} 
                    {% if i.lastname != '-'%}
                    {{i.lastname}}
                    {% endif %}
                </p>
            </a>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    <div class="content row add_employer edit_employer">
        <a href="{% url 'aup_add_employer' %}" class="add_employer form-control">Добавить сотрудника</a>
    </div>
    {%for i in employers %}
        {%if i.division_id == user.division_id%}
        <div class="birthday_calc" style="display: none;">
            <input type="text" id="birth_id" value="{{i.surname}}" class="birth_id">
            <input type="number" id="year_n" value="{{date_now.year}}" class="year_n">
            <input type="number" id="month_n" value="{{date_now.month}}" class="month_n">
            <input type="number" id="day_n" value="{{date_now.day}}" class="day_n">
            <input type="number" id="year_b" value="{{i.birthday.year}}" class="year_b">
            <input type="number" id="month_b" value="{{i.birthday.month}}" class="month_b">
            <input type="number" id="day_b" value="{{i.birthday.day}}" class="day_b">
            <input type="number" id="age" value="" class="age">
        </div>
        {%endif%}
    {%endfor%}
    <script>
        window.addEventListener('load', () => {
            let all_birthday = document.querySelectorAll('.birthday_calc')    
            for (let i = 0; i<all_birthday.length; i++){
                let year_now = Number(all_birthday[i].querySelector('.year_n').value)
                let month_now = Number(all_birthday[i].querySelector('.month_n').value)
                let day_now = Number(all_birthday[i].querySelector('.day_n').value)
                let year_birth = Number(all_birthday[i].querySelector('.year_b').value)
                let month_birth = Number(all_birthday[i].querySelector('.month_b').value)
                let day_birth = Number(all_birthday[i].querySelector('.day_b').value)
                let age = year_now - year_birth
                if (month_now < month_birth || (month_now == month_birth && day_now < day_birth)){
                    age--;
                }
                all_birthday[i].querySelector('.age').value = age;
            }
        })
    </script>
{% endblock%}